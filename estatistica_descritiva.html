<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge"> 
        <script src="./plotly.min.js">//https://cdn.plot.ly/plotly-latest.min.js</script> 
        <title>Estatística Descritiva</title>
    </head>
    <style>
        table tr td {
            border: solid 1px #000;
        }
        table thead tr th {
            border: solid 1px #000;
        }
    </style>
    <body>

        <header class="header">
            <div class="container">
                <nav class="nav">

                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="index.html" class="nav-link">Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">Estatística Descritiva</a>
                        </li>
                    </ul>

                </nav>
            </div>
        </header>

        <main>
            <div class="container">
                <div class="heading">
                    <h1 class="title">Estatística Descritiva</h1>
                </div>
            </div>

            <section>
                <div class="upload">
                    <label>Importar Dados</label>
                    <input type="file" class="importarArquivo" accept=".csv, .xlsx, .xlsm">
                    <button class="importarArquivo">Salvar</button>
                </div>

                <div class="manual">
                    <label>Inserir Dados</label>
                    <input type="text" id="inserirManual" class="inserirManual" placeholder="Inserir Dados Manualmente">
                    <small>Os dados devem ser separados por ponto e vírgula(;)</small>
                </div>

                <div class="nomeVariavel">
                    <label>Nome da Variável</label>
                    <input type="text" id="nomeVariavel" class="nomeVariavel" placeholder="Inserir Nome da Variável">
                </div>

                <div class="amostraPopulacao">
                    <button class="amostra">Amostra</button>
                    <button class="populacao">População</button>
                </div>

                <div class="tipoVariavel">
                    <label>Tipo de Variável</label>
                    <select id="tipoVariavel">
                        <option>(Selecione)</option>
                        <option>Qualitativa Nominal</option>
                        <option>Qualitativa Ordinal</option>
                        <option>Quantitativa Discreta</option>
                        <option>Quantitativa Contínua</option>
                    </select>
                </div>

                <div class="calcular">
                    <button id="botaoCalcular" class="calcular">Calcular</button>
                </div>

                <div class="exibirTabela">
                    <table id="tabela" class="tabela" style="display: none">
                        <thead id="cabecalhoTabela">
                            <tr>
                                <th id="tituloTabela"></th>
                            </tr>
                            <tr>
                                <th id="freqSimples"></th>
                            </tr>
                            <tr>
                                <th id="freqRelativa"></th>
                            </tr>
                            <tr>
                                <th id="freqAcumulada"></th>
                            </tr>
                            <tr>
                                <th id="freqAcumuladaPerc"></th>
                            </tr>
                        </thead>

                        <tbody id="corpoTabela">
                            
                        </tbody>
                    </table>
                </div>

                <div class="container">
                    <h1>Medidas de Tendência Central</h1>
                    <div class="media" id="media">
                        
                    </div>

                    <div class="mediana" id="mediana">

                    </div>

                    <div class="moda" id="moda">
                        
                    </div>

                </div>

                <div class="container">
                    <div id="grafico">
                        
                    </div>
                </div>

            </section>


            <script>

                const dadoManual = document.querySelector('#inserirManual')
                const botaoCalcular = document.querySelector('#botaoCalcular')
                const nomeVariavel = document.querySelector('#nomeVariavel')
                const tabela = document.querySelector('#tabela')
                const tituloTabela = document.querySelector('#tituloTabela')
                const corpoTabela = document.querySelector('#corpoTabela')
                const tipoVariavel = document.querySelector('#tipoVariavel')
                const freqSimples = document.querySelector('#freqSimples')
                const cabecalhoTabela = document.querySelector('#cabecalhoTabela')
                const freqRelativa = document.querySelector('#freqRelativa')
                const freqAcumulada = document.querySelector('#freqAcumulada')
                const freqAcumuladaPerc = document.querySelector('#freqAcumuladaPerc')
                const resultMedia = document.querySelector('#media')
                const resultModa = document.querySelector('#moda')
                const resultMediana = document.querySelector('#mediana')
                const grafico = document.querySelector('#grafico')

                function exibirManual() {

                    cabecalhoTabela.innerHTML = ""
                    corpoTabela.innerHTML = ""

                    let valido = true

                    let stringManual = dadoManual.value
                    console.log(stringManual)

                    let vetorDados = stringManual.split(';')

                    for(let i = 0; i < vetorDados.length; i++) {
                        vetorDados[i] = vetorDados[i].trim()
                    }

                    if(nomeVariavel.value == '') {
                        alert('Informe o nome da variável.')
                        nomeVariavel.focus()
                        valido = false
                    }
                    else if(tipoVariavel.selectedIndex <= 0) {
                        alert('Selecione o tipo de variável.')
                        tipoVariavel.focus()
                        valido = false
                    }


                    if(valido == true) {

                        tituloTabela.innerHTML = nomeVariavel.value
                        cabecalhoTabela.appendChild(tituloTabela)

                        freqSimples.innerHTML = "Freq. Simples"
                        cabecalhoTabela.appendChild(freqSimples)

                        freqRelativa.innerHTML = "Freq. Relativa (%)"
                        cabecalhoTabela.appendChild(freqRelativa)

                        freqAcumulada.innerHTML = "Freq. Acumulada"
                        cabecalhoTabela.appendChild(freqAcumulada)

                        freqAcumuladaPerc.innerHTML = "Freq. Acumulada (%)"
                        cabecalhoTabela.appendChild(freqAcumuladaPerc)

                        if(tipoVariavel.selectedIndex == 1 || tipoVariavel.selectedIndex == 2) {
                            vetorDados.sort()
                            console.log(vetorDados)


                            let vetorVariavel = []
                            let percentualTotal = 0
                            for(let i = 0; i < vetorDados.length; i++) {
                                if(vetorDados[i] !== vetorDados[i + 1]) {
                                    vetorVariavel.push(vetorDados[i])
                                }
                            }
                            console.log('Vetor Variável: ' + vetorVariavel)


                            let vetorTotal = []
                            let vetorFreqTotal = []
                            for(let i = 0; i < vetorVariavel.length; i++) {
                                
                                let linha = document.createElement('tr')

                                let cont = 0
                                for(let j = 0; j < vetorDados.length; j++) {

                                    if (vetorVariavel[i] == vetorDados[j]) {
                                        cont = cont + 1
                                    }                            
                                }

                                // FREQUÊNCIA RELATIVA
                                let freqRelativa = (cont / vetorDados.length) * 100
                                percentualTotal = percentualTotal + freqRelativa

                                vetorTotal.push(cont)
                                vetorFreqTotal.push(freqRelativa)

                                let celulaVariavel = document.createElement('td')
                                let celulaFreqSim = document.createElement('td')
                                let celulaFreqRelativa = document.createElement('td')
                                let celulaFreqAcum = document.createElement('td')
                                let celulaFreqAcumPer = document.createElement('td')
                                
                                celulaVariavel.innerHTML = vetorVariavel[i]
                                celulaFreqSim.innerHTML = cont
                                celulaFreqRelativa.innerHTML = freqRelativa.toFixed(2) + '%'
                                // FREQUÊNCIA ACUMULADA
                                celulaFreqAcum.innerHTML = somaTotal(vetorTotal)

                                // FREQUÊNCIA ACUMULADA PERCENTUAL
                                celulaFreqAcumPer.innerHTML = somaTotal(vetorFreqTotal) + '%'

                                corpoTabela.appendChild(linha)
                                linha.appendChild(celulaVariavel)
                                linha.appendChild(celulaFreqSim)
                                linha.appendChild(celulaFreqRelativa)
                                linha.appendChild(celulaFreqAcum)
                                linha.appendChild(celulaFreqAcumPer)
                            }

                            let linhaTotal = document.createElement('tr')
                            linhaTotal.innerHTML = "Total"
                            corpoTabela.appendChild(linhaTotal)

                            function somaTotal(vetor) {
                                let soma = 0
                                for(let i in vetor) {
                                    soma += vetor[i]
                                }
                                return soma
                            }

                            let total = document.createElement('td')
                            total.innerHTML = somaTotal(vetorTotal)
                            linhaTotal.appendChild(total)

                            let totalPercentual = document.createElement('td')
                            totalPercentual.innerHTML = percentualTotal + '%'
                            linhaTotal.appendChild(totalPercentual)


                            // MEDIANA
                            let mediana
                            let posicao = 0
                            if((vetorDados.length % 2) === 0) {
                                posicao = vetorDados.length / 2
                                console.log('É par. Posição: ' + posicao + ' e ' + (posicao + 1))
                                mediana = vetorDados[posicao - 1] 
                                console.log(posicao)                            
                            }
                            else {
                                posicao = ((vetorDados.length - 1) / 2) + 1
                                console.log('É ímpar. Posição: ' + posicao)
                                mediana = vetorDados[posicao]
                            }

                            resultMediana.innerHTML = 'Mediana: ' + mediana 
                            
                            // MODA
                            console.log(vetorTotal)

                            let maior = vetorTotal[0]
                            for(let i = 1; i < vetorTotal.length; i++) {
                                if(vetorTotal[i] > maior) {
                                    maior = vetorTotal[i]
                                }
                            } 

                            let vetorModa = []
                            for(let i = 0; i < vetorTotal.length; i++) {
                                if(vetorTotal[i] === maior) {
                                    vetorModa.push(vetorVariavel[i])
                                }
                            }

                            resultModa.innerHTML = 'Moda: ' + vetorModa

                            console.log(maior)
                            console.log(vetorModa)


                            // GRÁFICO    
                            let dados = [{
                                values: vetorFreqTotal,
                                labels: vetorVariavel,
                                hoverinfo: 'label+percent',
                                type: 'pie'
                            }];

                            let layout = {
                                title: '<i><b>' + nomeVariavel.value + '<b><i>',
                                titlefont: {
                                    size: 15,
                                    color: 'rgb(0, 0, 0)'
                                },
                                height: 400,
                                width: 500
                            };

                            Plotly.newPlot('grafico', dados, layout);
                        }


                        // QUANTITATIVA DISCRETA ---------------------------
                        if(tipoVariavel.selectedIndex == 3) {

                            
                            for(let i = 0; i < vetorDados.length; i++) {

                                if(vetorDados[i].indexOf(',')) {
                                    vetorDados[i] = vetorDados[i].replace(",", ".")
                                    vetorDados[i] = parseFloat(vetorDados[i])
                                }
                                else {
                                    vetorDados[i] = parseInt(vetorDados[i])
                                }
                            }
                            
                            vetorDados.sort(function(a, b) {
                                return a - b;
                            });

                            console.log(vetorDados)


                            let vetorVariavel = []
                            let percentualTotal = 0
                            let vetorFac = []
                            for(let i = 0; i < vetorDados.length; i++) {
                                if(vetorDados[i] !== vetorDados[i + 1]) {
                                    vetorVariavel.push(vetorDados[i])
                                }
                            }
                            console.log('Vetor Variável: ' + vetorVariavel)

                            let vetorTotal = []
                            let vetorFreqTotal = []
                            for(let i = 0; i < vetorVariavel.length; i++) {
                                
                                let linha = document.createElement('tr')

                                let cont = 0
                                for(let j = 0; j < vetorDados.length; j++) {

                                    if (vetorVariavel[i] == vetorDados[j]) {
                                        cont = cont + 1
                                    }                            
                                }

                                vetorTotal.push(cont)

                                // FREQUÊNCIA RELATIVA
                                let freqRelativa = (cont / vetorDados.length) * 100
                                percentualTotal = percentualTotal + freqRelativa

                                vetorFreqTotal.push(freqRelativa)

                                let celulaVariavel = document.createElement('td')
                                let celulaFreqSim = document.createElement('td')
                                let celulaFreqRelativa = document.createElement('td')
                                let celulaFreqAcum = document.createElement('td')
                                let celulaFreqAcumPer = document.createElement('td')
                                
                                celulaVariavel.innerHTML = vetorVariavel[i]
                                celulaFreqSim.innerHTML = cont
                                celulaFreqRelativa.innerHTML = freqRelativa.toFixed(2) + '%'
                                // FREQUÊNCIA ACUMULADA
                                celulaFreqAcum.innerHTML = somaTotal(vetorTotal)
                                vetorFac.push(somaTotal(vetorTotal))

                                // FREQUÊNCIA ACUMULADA PERCENTUAL
                                celulaFreqAcumPer.innerHTML = somaTotal(vetorFreqTotal) + '%'

                                corpoTabela.appendChild(linha)
                                linha.appendChild(celulaVariavel)
                                linha.appendChild(celulaFreqSim)
                                linha.appendChild(celulaFreqRelativa)
                                linha.appendChild(celulaFreqAcum)
                                linha.appendChild(celulaFreqAcumPer)
                            }
                        
                            let linhaTotal = document.createElement('tr')
                            linhaTotal.innerHTML = "Total"
                            corpoTabela.appendChild(linhaTotal)

                            function somaTotal(vetor) {
                                let soma = 0
                                for(let i in vetor) {
                                    soma += vetor[i]
                                }
                                return soma
                            }

                            let total = document.createElement('td')
                            total.innerHTML = somaTotal(vetorTotal)
                            linhaTotal.appendChild(total)

                            let totalPercentual = document.createElement('td')
                            totalPercentual.innerHTML = Math.round(percentualTotal) + '%'
                            linhaTotal.appendChild(totalPercentual)
                            
                            // MÉDIA PONDERADA SIMPLES
                            let somaMedia = 0
                            for(let i = 0; i < vetorVariavel.length; i++) {
                                somaMedia += vetorVariavel[i] * vetorTotal[i]
                            }
                            
                            let media = somaMedia / somaTotal(vetorTotal)

                            resultMedia.innerHTML = 'Média: ' + media.toFixed(2)


                            // MEDIANA
                            let mediana
                            let posicao = 0
                            if((vetorDados.length % 2) === 0) {
                                posicao = vetorDados.length / 2
                                console.log('É par. Posição: ' + posicao + ' e ' + (posicao + 1))
                                mediana = vetorDados[posicao - 1] 
                                console.log(posicao)                            
                            }
                            else {
                                posicao = ((vetorDados.length - 1) / 2) + 1
                                console.log('É ímpar. Posição: ' + posicao)
                                mediana = vetorDados[posicao]
                            }

                            resultMediana.innerHTML = 'Mediana: ' + mediana 
                            
                            // MODA
                            console.log('Vetortotal: ' + vetorTotal)

                            let maior = vetorTotal[0]
                            for(let i = 1; i < vetorTotal.length; i++) {
                                if(vetorTotal[i] > maior) {
                                    maior = vetorTotal[i]
                                }
                            } 

                            let vetorModa = []
                            for(let i = 0; i < vetorTotal.length; i++) {
                                if(vetorTotal[i] === maior) {
                                    vetorModa.push(vetorVariavel[i])
                                }
                            }

                            resultModa.innerHTML = 'Moda: ' + vetorModa

                            console.log(maior)
                            console.log(vetorModa)


                            // GRÁFICO
                            console.log('Vetor da freq. para ser usado no gráfico ' + vetorFreqTotal)
                            console.log('Vetor de labels para ser usado no gráfico ' + vetorVariavel)
    
                            let dados = [{
                                x: vetorVariavel,
                                y: vetorFreqTotal,
                                hoverinfo: 'label+percent',
                                type: 'bar'
                            }];

                            let layout = {
                                title: '<i><b>' + nomeVariavel.value + '<b><i>',
                                titlefont: {
                                    size: 15,
                                    color: 'rgb(0, 0, 0)'
                                },
                                height: 400,
                                width: 500,
                                xaxis: {
                                    title: nomeVariavel.value,
                                    color: 'rgb(0, 0, 0)'
                                },
                                yaxis: {
                                    title: 'Frequência Relativa (%)',
                                    color: 'rgb(0, 0, 0)'
                                }
                            };

                            Plotly.newPlot('grafico', dados, layout);
                        } 

                        // QUANTITATIVA CONTÍNUA
                        if(tipoVariavel.selectedIndex == 4) {
                                                        
                            for(let i = 0; i < vetorDados.length; i++) {

                                if(vetorDados[i].indexOf(',')) {
                                    vetorDados[i] = vetorDados[i].replace(",", ".")
                                    vetorDados[i] = parseFloat(vetorDados[i])
                                }
                                else {
                                    vetorDados[i] = parseInt(vetorDados[i])
                                }
                            }

                            vetorDados.sort(function(a, b) {
                                return a - b;
                            });

                            console.log('Vetor Dados: ' + vetorDados)

                            // AMPLITUDE TOTAL DA SEQUÊNCIA (MAIOR NÚMERO DA DISTRIBUIÇÃO - MENOR NÚMERO DA DISTRIBUIÇÃO)
                            let amplitude = (vetorDados[vetorDados.length - 1]) - vetorDados[0]
                            console.log(amplitude) 

                            // QUANTIDADE DE CLASSES (QUANTIDADE DE LINHAS)
                            let k = Math.trunc(Math.sqrt(vetorDados.length)) // Raiz quadrada de n, n é a quantidade total pesquisada
                            let kMenos1 = k - 1
                            let kMais1 = k + 1
                        
                            console.log(kMenos1, k, kMais1)

                            // INTERVALO DE CLASSE = AMPLITUDE + 1(PELO MENOS) / QUANTIDADE DE CLASSES                            
                            let intervalo
                            let qtLinhas
                            let controle = false
                            while(controle === false) {

                                amplitude = amplitude + 1

                                if(amplitude % k === 0) {
                                    intervalo = (amplitude) / k
                                    qtLinhas = k
                                    controle = true
                                }
                                else if(amplitude % kMenos1 === 0) {
                                    intervalo = (amplitude) / kMenos1
                                    qtLinhas = kMenos1
                                    controle = true
                                }
                                else if(amplitude % kMenos1 === 0) {
                                    intervalo = (amplitude) / kMais1
                                    qtLinhas = kMais1
                                    controle = true
                                }                                
                            }   
                            console.log("Amplitude: " + amplitude)
                            console.log("Quantidade de Classe: " + qtLinhas)
                            console.log("Intervalo: " + intervalo)
                            console.log(vetorDados)


                            let vetorVariavel = []
                            for(let i = 0; i < vetorDados.length; i++) {
                                if(vetorDados[i] !== vetorDados[i + 1]) {
                                    vetorVariavel.push(vetorDados[i])
                                }
                            }
                            console.log('Vetor Variável: ' + vetorVariavel)

                            let inferior = vetorDados[0]
                            let vetorTotal = []
                            let vetorFreqTotal = []
                            let percentualTotal = 0
                            let vetorMediaIC = []
                            let vetorGrafico = []
                            for(let i = 0; i < qtLinhas; i++) {
                                let superior = inferior + intervalo

                                let mediaIC = (inferior + superior) / 2
                                vetorMediaIC.push(mediaIC)

                                //console.log(mediaIC)
                                //console.log(vetorMediaIC)

                                function contTotal() {
                                    let cont = 0

                                    for(let i = 0; i < vetorDados.length; i++) {
                                        if((vetorDados[i] >= inferior) && (vetorDados[i] < superior)) {
                                            cont = cont + 1
                                        }
                                    }
                                    return cont
                                }

                                vetorTotal.push(contTotal())
                                console.log(vetorTotal)
                                console.log(vetorMediaIC)

                                // FREQUÊNCIA RELATIVA
                                let freqRelativa = (contTotal() / vetorDados.length) * 100
                                percentualTotal = percentualTotal + freqRelativa

                                vetorFreqTotal.push(freqRelativa)

                                let linha = document.createElement('tr')
                                let celula = document.createElement('td')

                                celula.innerHTML = inferior + " &#8866; " + superior
                                corpoTabela.appendChild(linha)
                                linha.appendChild(celula)

                                let celulaCont = document.createElement('td')
                                celulaCont.innerHTML = contTotal()
                                
                                linha.appendChild(celulaCont)

                                let celulaFreqRelativa = document.createElement('td')
                                celulaFreqRelativa.innerHTML = freqRelativa.toFixed(2) + '%'

                                linha.appendChild(celulaFreqRelativa)

                                // FREQUÊNCIA ACUMULADA
                                let celulaFreqAcum = document.createElement('td')
                                celulaFreqAcum.innerHTML = somaTotal(vetorTotal)
                                
                                linha.appendChild(celulaFreqAcum)

                                // FREQUÊNCIA ACUMULADA PERCENTUAL
                                let celulaFreqAcumPer = document.createElement('td')
                                celulaFreqAcumPer.innerHTML = somaTotal(vetorFreqTotal) + '%'

                                linha.appendChild(celulaFreqAcumPer)

                                vetorGrafico.push(inferior)

                                inferior = superior
                            }

                            vetorGrafico.push(inferior)
                            console.log('Versão final: ' + vetorGrafico)

                            let linhaTotal = document.createElement('tr')
                            linhaTotal.innerHTML = "Total"
                            corpoTabela.appendChild(linhaTotal)

                            function somaTotal(vetor) {
                                let soma = 0
                                for(let i in vetor) {
                                    soma += vetor[i]
                                }
                                return soma
                            }

                            let total = document.createElement('td')
                            total.innerHTML = somaTotal(vetorTotal)
                            linhaTotal.appendChild(total)

                            let totalPercentual = document.createElement('td')
                            totalPercentual.innerHTML = percentualTotal + '%'
                            linhaTotal.appendChild(totalPercentual)
                            
                            // MÉDIA PONDERA SIMPLES
                            let prodSum = 0
                            let media = 0
                            for(let i = 0; i < vetorMediaIC.length; i++) {
                                prodSum += vetorMediaIC[i] * vetorTotal[i]
                            }
                
                            media = prodSum / somaTotal(vetorTotal)

                            resultMedia.innerHTML = 'Média: ' + media


                            // MODA
                            console.log(vetorTotal)

                            let maior = vetorTotal[0]
                            for(let i = 1; i < vetorTotal.length; i++) {
                                if(vetorTotal[i] > maior) {
                                    maior = vetorTotal[i]
                                }
                            } 

                            let vetorModa = []
                            for(let i = 0; i < vetorTotal.length; i++) {
                                if(vetorTotal[i] === maior) {
                                    vetorModa.push(vetorMediaIC[i])
                                }
                            }

                            resultModa.innerHTML = 'Moda: ' + vetorModa

                            console.log(vetorMediaIC)
                            console.log(maior)
                            console.log(vetorModa)


                            // GRÁFICO
                            console.log('Vetor da freq. para ser usado no gráfico ' + vetorFreqTotal)
                            console.log('Vetor de labels para ser usado no gráfico ' + vetorMediaIC)
                            console.log('Start: ' +  vetorGrafico[0])
                            console.log('Size: ' +  vetorGrafico.length)
                            console.log('end: ' +  vetorGrafico[vetorGrafico.length -  1])
                            console.log('Vetor grafico: ' +  vetorGrafico)

                            /*
                            let tracex = {
                                x: vetorGrafico,
                                type: 'histogram',
                                start: vetorGrafico[0],
                                size: vetorGrafico,
                            };
                            let tracey = {
                                y: vetorFreqTotal,
                                type: 'histogram',
                            };
                            let data = ([tracex], [tracey]);
                            Plotly.newPlot('grafico', data);
                            */
                            
                            let dados = [{
                                x: vetorGrafico,
                                //y: vetorFreqTotal,
                                hoverinfo: 'label+percent',
                                type: 'histogram',
                                xbins: {
                                    start: vetorGrafico[0],
                                    size: vetorGrafico,
                                },
                                ybins: {
                                    start: vetorFreqTotal[0],
                                    size: vetorFreqTotal,
                                }
                            }];

                            let layout = {
                                title: '<i><b>' + nomeVariavel.value + '<b><i>',
                                titlefont: {
                                    size: 15,
                                    color: 'rgb(0, 0, 0)'
                                },
                                height: 400,
                                width: 500,
                                xaxis: {
                                    title: nomeVariavel.value,
                                    color: 'rgb(0, 0, 0)'
                                },
                                yaxis: {
                                    title: 'Frequência Relativa (%)',
                                    color: 'rgb(0, 0, 0)'
                                }
                            };

                            Plotly.newPlot('grafico', dados, layout);

                        } 
                        // FIM DA QUANTITATIVA CONTÍNUA

                        tabela.style="display: normal"                        
                    }
                }

                botaoCalcular.addEventListener('click', exibirManual)
                
            </script>

        </main>
    </body>
</html>